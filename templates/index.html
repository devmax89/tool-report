<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIGIL Report Generator - Terna</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="main-container">
        <div class="app-header">
            <div class="header-content">
                <div class="logo-container">
                    <img src="{{ url_for('static', filename='logo/terna_logo.png') }}" alt="Terna Logo">
                </div>
                <div class="header-text">
                    <h1>DIGIL Report Generator</h1>
                    <p>Sistema di generazione report per dispositivi DIGIL</p>
                </div>
            </div>
        </div>
        
        <div class="form-container">
            <form id="reportForm" method="POST">
                <div class="form-grid">
                    <!-- Sezione Configurazione Device -->
                    <div class="form-section">
                        <h3>üì° Configurazione Device</h3>
                        
                        <div class="form-group">
                            <label for="num_sensors">Numero Sensori *</label>
                            <select class="form-select" id="num_sensors" name="num_sensors" required>
                                <option value="">Seleziona...</option>
                                <option value="3">3 Sensori</option>
                                <option value="6">6 Sensori</option>
                                <option value="12">12 Sensori</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="vendor">Vendor *</label>
                            <select class="form-select" id="vendor" name="vendor" required>
                                <option value="">Seleziona...</option>
                                <option value="MII">MII</option>
                                <option value="Indra/Olivetti">Indra/Olivetti</option>
                                <option value="Sirtiv2">Sirtiv2</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="device_id">Device ID *</label>
                            <input type="text" class="form-control" id="device_id" name="device_id" 
                                   placeholder="es. 1:1:2:16:22:DIGIL_MRN_0299" required>
                            <div class="form-text">Formato: 1:1:2:16:22:DIGIL_XXX_YYYY</div>
                        </div>
                    </div>
                    
                    <!-- Sezione Periodo Test -->
                    <div class="form-section">
                        <h3>üìÖ Periodo Test</h3>
                        
                        <div class="form-group">
                            <label>Data e Ora Inizio *</label>
                            <div class="datetime-grid">
                                <input type="date" class="form-control" id="start_date" name="start_date" required>
                                <input type="time" class="form-control" id="start_time" name="start_time" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Data e Ora Fine *</label>
                            <div class="datetime-grid">
                                <input type="date" class="form-control" id="end_date" name="end_date" required>
                                <input type="time" class="form-control" id="end_time" name="end_time" required>
                            </div>
                        </div>
                        
                        <div class="form-text">
                            * La data di fine viene auto-compilata quando inserisci la data di inizio
                        </div>
                    </div>
                </div>
            </form>
        </div>
        
        <div class="button-group">
            <button type="button" class="btn btn-secondary" onclick="showPreview()">
                üëÅÔ∏è Anteprima
            </button>
            <button type="submit" form="reportForm" class="btn btn-primary" formaction="/generate">
                üíæ Genera e Salva Report
            </button>
            <a href="/reset" class="btn btn-warning">
                üîÑ Reset Dispositivo
            </a>
        </div>
        
        <div id="preview" style="display:none;">
            <!-- Preview content will be loaded here -->
        </div>
        
        <div class="footer">
            <p>DIGIL Report Generator v1.0</p>
        </div>
    </div>

    <script>
        function showPreview() {
            const form = document.getElementById('reportForm');
            const formData = new FormData(form);
            
            // Mostra loading
            const previewDiv = document.getElementById('preview');
            previewDiv.innerHTML = '<div class="alert alert-info"><span class="spinner"></span> Caricamento anteprima...</div>';
            previewDiv.style.display = 'block';
            
            fetch('/preview', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(html => {
                previewDiv.innerHTML = html;
            })
            .catch(error => {
                previewDiv.innerHTML = '<div class="alert alert-danger">Errore nel caricamento dell\'anteprima</div>';
            });
        }
        
        // Auto-fill end date quando cambia start date
        document.getElementById('start_date').addEventListener('change', function() {
            const endDate = document.getElementById('end_date');
            if (!endDate.value) {
                endDate.value = this.value;
            }
        });
    </script>
</body>
</html>