## 📝 RIEPILOGO LOGICA
```
┌─────────────────────────────────────┐
│  INIZIO TEST ALLARMI                │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│  LOOP ogni 5 secondi                │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│  FASE A: Cerca valori EGM           │
│  (telemetria + lastval)             │
└──────────────┬──────────────────────┘
               │
               ▼
        ┌──────┴──────┐
        │ Tutti       │ NO
        │ trovati?    ├────────────┐
        └──────┬──────┘            │
               │ SI                │
               │                   ▼
               │      ┌─────────────────────────────┐
               │      │  FASE B: API Aggregata      │
               │      └──────────┬──────────────────┘
               │                 │
               │                 ▼
               │          ┌──────┴──────┐
               │          │ Tutti       │ NO
               │          │ trovati?    ├────────────┐
               │          └──────┬──────┘            │
               │                 │ SI                │
               │                 │                   ▼
               │                 │      ┌──────────────────────────┐
               │                 │      │  FASE C: MongoDB         │
               │                 │      │  (solo allarmi mancanti) │
               │                 │      └──────────┬───────────────┘
               │                 │                 │
               │                 │                 ▼
               │                 │          ┌──────┴──────────┐
               │                 │          │ TRUE trovato?   │ NO → Continua ad aspettare
               │                 │          └──────┬──────────┘
               │                 │                 │ SI
               │                 │                 ▼
               │                 │          ┌──────────────────────┐
               │                 │          │ Timestamp valido?    │
               │                 │          │ (rispetto filtro)    │
               │                 │          └──────┬──────┬────────┘
               │                 │                 │ SI   │ NO
               │                 │                 ▼      ▼
               │                 │         ✅ ACCETTA  ⏩ SCARTA
               │                 │
               ▼                 ▼
        ┌─────────────────────────────────────┐
        │  ✅ TEST VALIDATO                   │
        │  (tutti gli allarmi trovati)        │
        └─────────────────────────────────────┘